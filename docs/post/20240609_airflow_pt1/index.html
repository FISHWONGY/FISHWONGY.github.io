<html>

<head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="/images/favicon.svg">
    
    <link rel="stylesheet" href="/scss/global.min.febf67ca94390198daa11693993dfeaabba2e6affbd40f291ab5081feac1bddd.css">
    
    <link rel="stylesheet" href="/css/prism.css" />
    <link href="https://fonts.googleapis.com/css?family=Merriweather&display=swap" rel="stylesheet">
    

 






	




<title>On Airflow - Part 1 | Yu Wong</title>
<meta name="description" content="Airflow is a powerful orchestration tool for scheduling and orchestrating workflows. It is a great tool for data engineers to manage data pipelines. There are a lot of explanations in the internet about the benefit of using Apache Airflow, this link is an example.
In this article I will focus on discussing the process of deploy Apache Airflow to Kubernetes cluster by using Helm. We then will configure it to have all of the logs stored in Google Cloud Storage.">
<meta property="og:title" content="On Airflow - Part 1 | Yu Wong">
<meta property="og:site_name" content="Yu Wong">
<meta property="og:description" content="Airflow is a powerful orchestration tool for scheduling and orchestrating workflows. It is a great tool for data engineers to manage data pipelines. There are a lot of explanations in the internet about the benefit of using Apache Airflow, this link is an example.
In this article I will focus on discussing the process of deploy Apache Airflow to Kubernetes cluster by using Helm. We then will configure it to have all of the logs stored in Google Cloud Storage.">
<meta property="og:url" content="https://FISHWONGY.github.io/post/20240609_airflow_pt1/">
<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:image" content='https://FISHWONGY.github.io/images/on_airflow/cover-photo.png'><meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="On Airflow - Part 1 | Yu Wong">

	<link rel="canonical" href="https://FISHWONGY.github.io/post/20240609_airflow_pt1/">


	<meta name="twitter:site" content="@https://twitter.com/fishwongxd">
	<meta name="twitter:creator" content="@https://twitter.com/fishwongxd">

	<meta name="twitter:description" content="Airflow is a powerful orchestration tool for scheduling and orchestrating workflows. It is a great tool for data engineers to manage data pipelines. There are a lot of explanations in the internet about the benefit of using Apache Airflow, this link is an example.
In this article I will focus on discussing the process of deploy Apache Airflow to Kubernetes cluster by using Helm. We then will configure it to have all of the logs stored in Google Cloud Storage.">
<meta name="twitter:image" content="https://FISHWONGY.github.io/images/on_airflow/cover-photo.png">
<meta property="article:published_time" content="2024-06-09T00:00:00&#43;00:00">
	<meta property="article:updated_time" content="2024-06-09T00:00:00&#43;00:00">



    </head>


<body class="line-numbers">

    
    <script src="/js/initColors.js"></script>

    <div class="layout-styled">

        <Section class="section">
  <div class="nav-container">
    <a class="logo-link" href="/">
      <svg width="368.56" height="60" viewBox="0 0 368.56 60" xmlns="http://www.w3.org/2000/svg"><g id="svgGroup" stroke-linecap="round" fill-rule="evenodd" font-size="9pt" stroke="#898989" stroke-width="0.25mm" fill="#898989" style="stroke:#898989;stroke-width:0.25mm;fill:#898989"><path d="M 177.36 1.2 L 189.28 1.2 Q 190.181 1.2 190.787 1.439 A 2.005 2.005 0 0 1 191.48 1.88 A 2.021 2.021 0 0 1 191.933 2.603 Q 192.054 2.921 192.11 3.318 A 5.414 5.414 0 0 1 192.16 4.08 L 192.16 35.12 Q 192.16 37.68 191.96 39.88 Q 191.808 41.554 191.17 43.667 A 32.44 32.44 0 0 1 190.72 45.04 L 186.72 55.92 A 6.092 6.092 0 0 1 186.118 57.218 A 5.19 5.19 0 0 1 185.56 57.96 A 2.509 2.509 0 0 1 183.945 58.775 A 3.527 3.527 0 0 1 183.52 58.8 L 172.88 58.8 A 5.05 5.05 0 0 1 171.339 58.57 A 4.554 4.554 0 0 1 170.56 58.24 A 2.632 2.632 0 0 1 169.311 56.764 A 3.661 3.661 0 0 1 169.2 56.4 L 165.52 43.36 A 4.204 4.204 0 0 0 165.384 42.972 Q 165.184 42.486 164.92 42.28 A 1.326 1.326 0 0 0 164.095 42 A 1.635 1.635 0 0 0 164.08 42 L 163.36 42 A 1.384 1.384 0 0 0 162.821 42.103 A 1.314 1.314 0 0 0 162.52 42.28 A 1.131 1.131 0 0 0 162.297 42.52 Q 162.081 42.823 161.92 43.36 L 158.16 56.4 A 3.645 3.645 0 0 1 157.808 57.276 A 2.761 2.761 0 0 1 156.96 58.2 Q 156.08 58.8 154.8 58.8 L 144.24 58.8 A 3.413 3.413 0 0 1 142.931 58.554 A 3.212 3.212 0 0 1 142.04 58 A 4.323 4.323 0 0 1 140.865 56.327 A 5.332 5.332 0 0 1 140.72 55.92 L 136.72 44.88 Q 135.68 41.92 135.48 39.72 Q 135.28 37.52 135.28 34.96 L 135.28 4.08 Q 135.28 3.179 135.519 2.573 A 2.005 2.005 0 0 1 135.96 1.88 A 2.021 2.021 0 0 1 136.683 1.427 Q 137.001 1.307 137.398 1.25 A 5.414 5.414 0 0 1 138.16 1.2 L 150.48 1.2 Q 151.381 1.2 151.987 1.439 A 2.005 2.005 0 0 1 152.68 1.88 A 2.021 2.021 0 0 1 153.133 2.603 Q 153.254 2.921 153.31 3.318 A 5.414 5.414 0 0 1 153.36 4.08 L 153.36 33.52 L 158 23.44 Q 158.565 22.24 159.442 21.662 A 3.145 3.145 0 0 1 159.68 21.52 A 4.453 4.453 0 0 1 160.88 21.092 Q 161.406 20.981 162.013 20.963 A 7.962 7.962 0 0 1 162.24 20.96 L 165.6 20.96 A 6.846 6.846 0 0 1 166.746 21.051 Q 167.389 21.16 167.92 21.401 A 3.968 3.968 0 0 1 168.16 21.52 A 3.43 3.43 0 0 1 169.204 22.403 Q 169.516 22.79 169.769 23.294 A 6.241 6.241 0 0 1 169.84 23.44 L 174.48 33.52 L 174.48 4.08 Q 174.48 3.179 174.719 2.573 A 2.005 2.005 0 0 1 175.16 1.88 A 2.021 2.021 0 0 1 175.883 1.427 Q 176.201 1.307 176.598 1.25 A 5.414 5.414 0 0 1 177.36 1.2 Z M 276.32 58.8 L 264.32 58.8 Q 263.419 58.8 262.813 58.561 A 2.005 2.005 0 0 1 262.12 58.12 A 2.021 2.021 0 0 1 261.667 57.397 Q 261.547 57.079 261.49 56.682 A 5.414 5.414 0 0 1 261.44 55.92 L 261.44 4.08 Q 261.44 3.179 261.679 2.573 A 2.005 2.005 0 0 1 262.12 1.88 A 2.021 2.021 0 0 1 262.843 1.427 Q 263.161 1.307 263.558 1.25 A 5.414 5.414 0 0 1 264.32 1.2 L 272.64 1.2 A 8.086 8.086 0 0 1 273.802 1.279 Q 274.443 1.373 274.984 1.575 A 4.672 4.672 0 0 1 275.24 1.68 Q 276.32 2.16 277.36 3.36 L 292.88 21.12 L 292.88 4.08 Q 292.88 3.179 293.119 2.573 A 2.005 2.005 0 0 1 293.56 1.88 A 2.021 2.021 0 0 1 294.283 1.427 Q 294.601 1.307 294.998 1.25 A 5.414 5.414 0 0 1 295.76 1.2 L 307.76 1.2 Q 308.661 1.2 309.267 1.439 A 2.005 2.005 0 0 1 309.96 1.88 A 2.021 2.021 0 0 1 310.413 2.603 Q 310.534 2.921 310.59 3.318 A 5.414 5.414 0 0 1 310.64 4.08 L 310.64 55.92 Q 310.64 56.821 310.401 57.427 A 2.005 2.005 0 0 1 309.96 58.12 A 2.021 2.021 0 0 1 309.237 58.573 Q 308.919 58.694 308.522 58.75 A 5.414 5.414 0 0 1 307.76 58.8 L 295.76 58.8 Q 294.859 58.8 294.253 58.561 A 2.005 2.005 0 0 1 293.56 58.12 A 2.021 2.021 0 0 1 293.107 57.397 Q 292.987 57.079 292.93 56.682 A 5.414 5.414 0 0 1 292.88 55.92 L 292.88 46.08 L 279.2 29.52 L 279.2 55.92 Q 279.2 56.821 278.961 57.427 A 2.005 2.005 0 0 1 278.52 58.12 A 2.021 2.021 0 0 1 277.797 58.573 Q 277.479 58.694 277.082 58.75 A 5.414 5.414 0 0 1 276.32 58.8 Z M 107.36 4.08 L 107.36 43.68 A 21.686 21.686 0 0 1 107.028 47.553 A 17.483 17.483 0 0 1 106.28 50.36 A 10.921 10.921 0 0 1 103.183 54.866 A 13.434 13.434 0 0 1 102.44 55.48 A 14.98 14.98 0 0 1 99.861 57.051 Q 97.73 58.088 94.88 58.8 A 34.841 34.841 0 0 1 90.954 59.526 Q 88.909 59.792 86.534 59.909 A 79.42 79.42 0 0 1 82.64 60 A 76.425 76.425 0 0 1 77.837 59.858 Q 75.493 59.71 73.488 59.408 A 33.183 33.183 0 0 1 70.4 58.8 Q 65.6 57.6 62.84 55.48 A 11.957 11.957 0 0 1 60.238 52.776 A 10.566 10.566 0 0 1 59 50.36 A 18.189 18.189 0 0 1 58.051 46.157 A 22.845 22.845 0 0 1 57.92 43.68 L 57.92 4.08 Q 57.92 3.179 58.159 2.573 A 2.005 2.005 0 0 1 58.6 1.88 A 2.021 2.021 0 0 1 59.323 1.427 Q 59.641 1.307 60.038 1.25 A 5.414 5.414 0 0 1 60.8 1.2 L 73.36 1.2 Q 74.261 1.2 74.867 1.439 A 2.005 2.005 0 0 1 75.56 1.88 A 2.021 2.021 0 0 1 76.013 2.603 Q 76.134 2.921 76.19 3.318 A 5.414 5.414 0 0 1 76.24 4.08 L 76.24 40.56 A 3.441 3.441 0 0 0 77.295 43.103 A 4.25 4.25 0 0 0 77.44 43.24 Q 78.578 44.264 82.375 44.317 A 30.299 30.299 0 0 0 82.8 44.32 A 26.054 26.054 0 0 0 84.51 44.268 Q 87.303 44.084 88.24 43.24 A 3.577 3.577 0 0 0 89.185 41.925 A 3.589 3.589 0 0 0 89.44 40.56 L 89.44 4.08 Q 89.44 3.179 89.679 2.573 A 2.005 2.005 0 0 1 90.12 1.88 A 2.021 2.021 0 0 1 90.843 1.427 Q 91.161 1.307 91.558 1.25 A 5.414 5.414 0 0 1 92.32 1.2 L 104.48 1.2 Q 105.381 1.2 105.987 1.439 A 2.005 2.005 0 0 1 106.68 1.88 A 2.021 2.021 0 0 1 107.133 2.603 Q 107.254 2.921 107.31 3.318 A 5.414 5.414 0 0 1 107.36 4.08 Z M 365.68 58.8 L 340.48 58.8 A 40.094 40.094 0 0 1 335.263 58.484 Q 329.119 57.675 325.64 54.8 Q 321.23 51.156 320.838 43.925 A 26.699 26.699 0 0 1 320.8 42.48 L 320.8 17.52 A 22.613 22.613 0 0 1 321.261 12.797 Q 321.872 9.938 323.294 7.802 A 11.943 11.943 0 0 1 325.64 5.2 Q 330.48 1.2 340.48 1.2 L 360.48 1.2 Q 361.381 1.2 361.987 1.439 A 2.005 2.005 0 0 1 362.68 1.88 A 2.021 2.021 0 0 1 363.133 2.603 Q 363.254 2.921 363.31 3.318 A 5.414 5.414 0 0 1 363.36 4.08 L 363.36 13.76 Q 363.36 14.661 363.121 15.267 A 2.005 2.005 0 0 1 362.68 15.96 A 2.021 2.021 0 0 1 361.957 16.413 Q 361.639 16.534 361.242 16.59 A 5.414 5.414 0 0 1 360.48 16.64 L 343.84 16.64 Q 341.36 16.64 340.16 17.64 Q 339.015 18.595 338.963 20.461 A 6.444 6.444 0 0 0 338.96 20.64 L 338.96 39.76 Q 338.96 41.011 339.32 41.855 A 2.852 2.852 0 0 0 339.88 42.72 Q 340.664 43.538 342.117 43.659 A 6.316 6.316 0 0 0 342.64 43.68 L 350.4 43.68 L 350.4 31.2 Q 350.4 30.299 350.639 29.693 A 2.005 2.005 0 0 1 351.08 29 A 2.021 2.021 0 0 1 351.803 28.547 Q 352.121 28.427 352.518 28.37 A 5.414 5.414 0 0 1 353.28 28.32 L 365.68 28.32 Q 366.581 28.32 367.187 28.559 A 2.005 2.005 0 0 1 367.88 29 A 2.021 2.021 0 0 1 368.333 29.723 Q 368.454 30.041 368.51 30.438 A 5.414 5.414 0 0 1 368.56 31.2 L 368.56 55.92 Q 368.56 56.821 368.321 57.427 A 2.005 2.005 0 0 1 367.88 58.12 A 2.021 2.021 0 0 1 367.157 58.573 Q 366.839 58.694 366.442 58.75 A 5.414 5.414 0 0 1 365.68 58.8 Z M 31.12 58.8 L 18.16 58.8 Q 17.259 58.8 16.653 58.561 A 2.005 2.005 0 0 1 15.96 58.12 A 2.021 2.021 0 0 1 15.507 57.397 Q 15.387 57.079 15.33 56.682 A 5.414 5.414 0 0 1 15.28 55.92 L 15.28 45.68 L 3.04 29.28 A 25.522 25.522 0 0 1 2.011 27.793 Q 1.017 26.231 0.603 24.97 A 7.662 7.662 0 0 1 0.6 24.96 A 9.289 9.289 0 0 1 0.297 23.705 Q 0.066 22.401 0.015 20.547 A 40.042 40.042 0 0 1 0 19.44 L 0 4.08 Q 0 3.179 0.239 2.573 A 2.005 2.005 0 0 1 0.68 1.88 A 2.021 2.021 0 0 1 1.403 1.427 Q 1.721 1.307 2.118 1.25 A 5.414 5.414 0 0 1 2.88 1.2 L 15.2 1.2 Q 16.101 1.2 16.707 1.439 A 2.005 2.005 0 0 1 17.4 1.88 A 2.021 2.021 0 0 1 17.853 2.603 Q 17.974 2.921 18.03 3.318 A 5.414 5.414 0 0 1 18.08 4.08 L 18.08 17.2 A 17.861 17.861 0 0 0 18.123 18.418 A 20.731 20.731 0 0 0 18.16 18.88 A 3.338 3.338 0 0 0 18.607 20.257 A 4.099 4.099 0 0 0 18.8 20.56 L 22.48 26.32 A 4.841 4.841 0 0 0 22.747 26.75 Q 23.024 27.145 23.32 27.36 A 1.65 1.65 0 0 0 24.02 27.649 A 2.228 2.228 0 0 0 24.4 27.68 L 25.2 27.68 A 2.123 2.123 0 0 0 25.717 27.62 A 1.614 1.614 0 0 0 26.28 27.36 A 2.131 2.131 0 0 0 26.604 27.064 Q 26.753 26.899 26.897 26.685 A 5.005 5.005 0 0 0 27.12 26.32 L 30.8 20.56 Q 31.36 19.76 31.44 18.88 A 19.38 19.38 0 0 0 31.514 17.656 A 16.69 16.69 0 0 0 31.52 17.2 L 31.52 4.08 Q 31.52 3.179 31.759 2.573 A 2.005 2.005 0 0 1 32.2 1.88 A 2.021 2.021 0 0 1 32.923 1.427 Q 33.241 1.307 33.638 1.25 A 5.414 5.414 0 0 1 34.4 1.2 L 46.32 1.2 Q 47.221 1.2 47.827 1.439 A 2.005 2.005 0 0 1 48.52 1.88 A 2.021 2.021 0 0 1 48.973 2.603 Q 49.094 2.921 49.15 3.318 A 5.414 5.414 0 0 1 49.2 4.08 L 49.2 19.44 Q 49.2 22.552 48.742 24.348 A 7.509 7.509 0 0 1 48.56 24.96 A 11.537 11.537 0 0 1 47.988 26.301 Q 47.651 26.977 47.194 27.722 A 28.03 28.03 0 0 1 46.16 29.28 L 34 45.76 L 34 55.92 Q 34 56.821 33.761 57.427 A 2.005 2.005 0 0 1 33.32 58.12 A 2.021 2.021 0 0 1 32.597 58.573 Q 32.279 58.694 31.882 58.75 A 5.414 5.414 0 0 1 31.12 58.8 Z M 251.28 16.4 L 251.28 43.68 A 21.686 21.686 0 0 1 250.948 47.553 A 17.483 17.483 0 0 1 250.2 50.36 A 10.921 10.921 0 0 1 247.103 54.866 A 13.434 13.434 0 0 1 246.36 55.48 A 14.88 14.88 0 0 1 243.774 57.051 Q 242.437 57.699 240.812 58.22 A 31.607 31.607 0 0 1 238.76 58.8 A 35.559 35.559 0 0 1 234.764 59.531 Q 231.13 60 226.48 60 A 76.23 76.23 0 0 1 221.463 59.845 Q 219.114 59.69 217.097 59.379 A 34.086 34.086 0 0 1 214.16 58.8 Q 209.28 57.6 206.52 55.48 A 11.957 11.957 0 0 1 203.918 52.776 A 10.566 10.566 0 0 1 202.68 50.36 A 18.189 18.189 0 0 1 201.731 46.157 A 22.845 22.845 0 0 1 201.6 43.68 L 201.6 16.4 A 21.686 21.686 0 0 1 201.932 12.527 A 17.483 17.483 0 0 1 202.68 9.72 Q 203.76 6.72 206.52 4.56 A 14.579 14.579 0 0 1 209.112 2.964 Q 210.456 2.307 212.092 1.782 A 31.062 31.062 0 0 1 214.16 1.2 A 36.194 36.194 0 0 1 218.18 0.469 Q 220.233 0.205 222.603 0.09 A 79.867 79.867 0 0 1 226.48 0 A 76.654 76.654 0 0 1 231.288 0.142 Q 233.671 0.292 235.709 0.601 A 33.704 33.704 0 0 1 238.76 1.2 A 28.557 28.557 0 0 1 241.97 2.187 Q 243.527 2.774 244.783 3.501 A 13.633 13.633 0 0 1 246.36 4.56 A 12.302 12.302 0 0 1 248.919 7.235 A 10.723 10.723 0 0 1 250.2 9.72 A 18.189 18.189 0 0 1 251.15 13.924 A 22.845 22.845 0 0 1 251.28 16.4 Z M 219.76 19.28 L 219.76 40.8 A 3.441 3.441 0 0 0 220.815 43.343 A 4.25 4.25 0 0 0 220.96 43.48 A 2.793 2.793 0 0 0 221.818 43.978 Q 223.164 44.504 225.882 44.555 A 31.967 31.967 0 0 0 226.48 44.56 A 26.994 26.994 0 0 0 228.221 44.508 Q 230.759 44.344 231.778 43.653 A 2.053 2.053 0 0 0 232 43.48 A 3.577 3.577 0 0 0 232.945 42.165 A 3.589 3.589 0 0 0 233.2 40.8 L 233.2 19.28 A 3.34 3.34 0 0 0 232.145 16.817 A 4.459 4.459 0 0 0 232 16.68 A 2.793 2.793 0 0 0 231.142 16.183 Q 229.797 15.656 227.078 15.606 A 31.967 31.967 0 0 0 226.48 15.6 A 26.994 26.994 0 0 0 224.739 15.652 Q 222.201 15.817 221.182 16.508 A 2.053 2.053 0 0 0 220.96 16.68 A 3.757 3.757 0 0 0 220.14 17.709 A 3.3 3.3 0 0 0 219.76 19.28 Z" vector-effect="non-scaling-stroke"/></g></svg>
      <span class="header-hidden">Navigate back to the homepage</span>
    </a>
    <div class="nav-controls">
      <button id="copyButton" class="icon-wrapper">
        <svg
    class="icon-image"
    width="24"
    height="20"
    viewBox="0 0 24 20"
    fill="none"
    xmlns="http://www.w3.org/2000/svg"
    >
    <path
      fillRule="evenodd"
      clipRule="evenodd"
      d="M2 5C2 3.34328 3.34328 2 5 2H14C15.6567 2 17 3.34328 17 5V9C17 10.6567 15.6567 12 14 12H10C9.44771 12 9 12.4477 9 13C9 13.5523 9.44771 14 10 14H14C16.7613 14 19 11.7613 19 9V5C19 2.23872 16.7613 0 14 0H5C2.23872 0 0 2.23872 0 5V9C0 10.4938 0.656313 11.8361 1.6935 12.7509C2.10768 13.1163 2.73961 13.0767 3.10494 12.6625C3.47028 12.2483 3.43068 11.6164 3.0165 11.2511C2.39169 10.6999 2 9.89621 2 9V5ZM7 11C7 9.34328 8.34328 8 10 8H14C14.5523 8 15 7.55228 15 7C15 6.44772 14.5523 6 14 6H10C7.23872 6 5 8.23872 5 11V15C5 17.7613 7.23872 20 10 20H19C21.7613 20 24 17.7613 24 15V11C24 9.50621 23.3437 8.16393 22.3065 7.24906C21.8923 6.88372 21.2604 6.92332 20.8951 7.3375C20.5297 7.75168 20.5693 8.38361 20.9835 8.74894C21.6083 9.30007 22 10.1038 22 11V15C22 16.6567 20.6567 18 19 18H10C8.34328 18 7 16.6567 7 15V11Z"
      fill="#000"
    />
</svg>
        <div id="toolTip" class="tool-tip " >
            copied
        </div>
        <input id="copyText" style="opacity: 0;" type="text" class="tool-tip " />
      </button>

      <button id="themeColorButton" class="icon-wrapper"> 
        <div id="sunRays" class="sun-rays"></div>
        <div id="moonOrSun" class="moon-or-sun"></div>
        <div id="moonMask" class="moon-mask"></div>
      </button>
    </div>
</div>
</Section>


<script src="/js/toggleLogos.js"></script>


<script src="/js/toggleColors.js"></script>


<script src="/js/copyUrl.js"></script>

        

<section class="section narrow">

    <section id="articleHero" class="section narrow">
    <div class="article-hero">
        <header class="article-header">
            <h1 class="article-hero-heading">On Airflow - Part 1</h1>
            <div class="article-hero-subtitle">
                <div class="article-meta">
                    


    
            <a href="/authors/hugo-authors/" class="article-author-link">
                
                    <div class="article-author-avatar">
                        <img src="/images/profile-02.jpg" />
                    </div>
                
                
                <strong>Yu Wong</strong>
                
                <span class="hide-on-mobile">,&nbsp;</span>
            </a>
    



<script src="/js/collapseAuthors.js"></script>
                    June 9, 2024
                    • 8 min read
                </div>
            </div>
        </header>
        
        <div class="article-hero-image" id="ArticleImage__Hero">
            <img src="/images/on_airflow/cover-photo.png">
        </div>
        
    </div>
</section>


    <aside id="progressBar" class="aside-container">
    <div class="aside-align">
      <div>
        <div class="overlap-container">
        </div>
      </div>
    </div>

    <div class="progress-container" tabIndex={-1}>
        <div class="track-line" aria-hidden="true">
            <div id="progressIndicator" class="progress-line"></div>
        </div>
    </div>
</aside>


    <article  id="articleContent" class="post-content" style="position:relative;">
        <p>Airflow is a powerful orchestration tool for scheduling and orchestrating workflows. It is a great tool for data engineers to manage data pipelines. There are a lot of explanations in the internet about the benefit of using Apache Airflow, this <a href="https://medium.com/analytics-and-data/10-benefits-to-using-airflow-33d312537bae">link</a> is an example.</p>
<p>In this article I will focus on discussing the process of deploy Apache Airflow to Kubernetes cluster by using Helm. We then will configure it to have all of the logs stored in Google Cloud Storage. Furthermore, we will use the Git-Sync feature to automatically sync DAGs codes from GitHub to Apache Airflow.</p>
<p><u><b>
<p style="font-size:20pt ">
Prerequisites
</b></u></p>
<p>1 - Install Helm and Kind (optional)</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">brew install helm
brew install kind
</code></pre></div><p>2 - Have a Kubernetes cluster running</p>
<p>If you already have a Kubernetes cluster running, you can skip this step. Otherwise, you can follow the below step to use Kind to create a Kubernetes cluster locally, or set up a Kubernetes cluster in Google Cloud Platform.</p>
<p>For the content in this post, for demo purposes, I will use <code>kind</code>, and mount all of our pods back to GCP so that it runs like on GKE.</p>
<p><u>Create a Kubernetes cluster using Kind</u></p>
<p>We will need a kind-cluster.yaml to create the cluster. The file looks something as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">kind</span>: <span style="color:#ae81ff">Cluster</span>
<span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">kind.x-k8s.io/v1alpha4</span>
<span style="color:#f92672">nodes</span>:
- <span style="color:#f92672">role</span>: <span style="color:#ae81ff">control-plane</span>
- <span style="color:#f92672">role</span>: <span style="color:#ae81ff">worker</span>
  <span style="color:#f92672">kubeadmConfigPatches</span>:
  - |<span style="color:#e6db74">
</span><span style="color:#e6db74">    kind: JoinConfiguration
</span><span style="color:#e6db74">    nodeRegistration:
</span><span style="color:#e6db74">      kubeletExtraArgs:
</span><span style="color:#e6db74">        node-labels: &#34;node=worker_1&#34;</span>    
  <span style="color:#f92672">extraMounts</span>:
    - <span style="color:#f92672">hostPath</span>: <span style="color:#ae81ff">./data</span>
      <span style="color:#f92672">containerPath</span>: <span style="color:#ae81ff">/tmp/data</span>
- <span style="color:#f92672">role</span>: <span style="color:#ae81ff">worker</span>
  <span style="color:#f92672">kubeadmConfigPatches</span>:
  - |<span style="color:#e6db74">
</span><span style="color:#e6db74">    kind: JoinConfiguration
</span><span style="color:#e6db74">    nodeRegistration:
</span><span style="color:#e6db74">      kubeletExtraArgs:
</span><span style="color:#e6db74">        node-labels: &#34;node=worker_2&#34;</span>    
  <span style="color:#f92672">extraMounts</span>:
    - <span style="color:#f92672">hostPath</span>: <span style="color:#ae81ff">./data</span>
      <span style="color:#f92672">containerPath</span>: <span style="color:#ae81ff">/tmp/data </span>
- <span style="color:#f92672">role</span>: <span style="color:#ae81ff">worker</span>
  <span style="color:#f92672">kubeadmConfigPatches</span>:
  - |<span style="color:#e6db74">
</span><span style="color:#e6db74">    kind: JoinConfiguration
</span><span style="color:#e6db74">    nodeRegistration:
</span><span style="color:#e6db74">      kubeletExtraArgs:
</span><span style="color:#e6db74">        node-labels: &#34;node=worker_3&#34;</span>    
  <span style="color:#f92672">extraMounts</span>:
    - <span style="color:#f92672">hostPath</span>: <span style="color:#ae81ff">./data</span>
      <span style="color:#f92672">containerPath</span>: <span style="color:#ae81ff">/tmp/data</span>
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">kind create cluster --name airflow-cluster --config kind-cluster.yaml
</code></pre></div><p><u>Setting up GKE</u></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">gcloud container clusters create airflow-cluster \
--machine-type n1-standard-4 \
--num-nodes 1 \
--region <span style="color:#e6db74">&#34;us-central1&#34;</span>
</code></pre></div><p><u><b>
<p style="font-size:20pt ">
Install Apache Airflow
</b></u></p>
<p>First, we will create a namespace for Apache Airflow and switch to the context we just set up if you have multiple Kubernetes clusters running.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k create ns airflow

k get ns

k config use-context kind-airflow-cluster
</code></pre></div><p>Then, we will add the Apache Airflow Helm repository and install Apache Airflow using Helm.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">helm repo add apache-airflow https<span style="color:#960050;background-color:#1e0010">:</span>//airflow.apache.org

helm repo update

helm install airflow apache-airflow/airflow --namespace airflow --debug --timeout 100m0s

helm ls -n airflow
</code></pre></div><p>After installing, we will be able see the running pods.</p>
<p align="center">
<img alt = 'png' src='/images/on_airflow/k-get-pods.png'/>
</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># to check logs of pods</span>
k logs -n airflow airflow-scheduler-85b4d4588f-tfxww -c scheduler
</code></pre></div><p>Getting the values.yaml file</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">helm show values apache-airflow/airflow &gt; values.yaml
</code></pre></div><p><u><b>
<p style="font-size:20pt ">
Configure Apache Airflow
</b></u></p>
<p><u><b>1 - Configure env variables</b></u></p>
<p>To add a env var, on values.yaml modify the part <code>extraEnvFrom</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">extraEnvFrom</span>: |<span style="color:#e6db74">
</span><span style="color:#e6db74">  - configMapRef:
</span><span style="color:#e6db74">      name: &#39;airflow-variables&#39;</span>  
</code></pre></div><p>Then on the same level of the values.yaml, we will need a variables.yaml, it will look something as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">apiVersion</span>: <span style="color:#ae81ff">v1</span>
<span style="color:#f92672">kind</span>: <span style="color:#ae81ff">ConfigMap</span>
<span style="color:#f92672">metadata</span>:
  <span style="color:#f92672">namespace</span>: <span style="color:#ae81ff">airflow</span>
  <span style="color:#f92672">name</span>: <span style="color:#ae81ff">airflow-variables</span>
<span style="color:#f92672">data</span>:
  <span style="color:#f92672">AIRFLOW_VAR_GCP_BUCKET</span>: <span style="color:#e6db74">&#34;gcs-airflow&#34;</span>
  <span style="color:#f92672">AIRFLOW_VAR_GCP_PROJECT_ID</span>: <span style="color:#e6db74">&#34;gcp-prj-id&#34;</span><span style="color:#ae81ff">&#34;</span>
</code></pre></div><p>After saving the varaibles.yaml files, run</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k apply <span style="color:#f92672">-f</span> variables.yaml -n airflow

helm upgrade --install airflow apache-airflow/airflow -n airflow <span style="color:#f92672">-f</span> values.yaml --debug
</code></pre></div><p>To test does the env var added properly</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k get configmap airflow-variables -n airflow -o yam
</code></pre></div><p>Exec into our pods, it could be any prod, I will use the webserver pod as an example</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k exec --stdin --tty -n airflow airflow-webserver-12323-1232 -- /bin/bash
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Method 1</span>
printenv | grep AIRFLOW_VAR
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># Method 2 - run python inside the pod</span>
python
</code></pre></div><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> airflow.models <span style="color:#f92672">import</span> Variable

Variable<span style="color:#f92672">.</span>get(<span style="color:#e6db74">&#34;GCP_BUCKET&#34;</span>)
<span style="color:#75715e"># This should print your env var, note that Variable.get(&#34;AIRFLOW_VAR_MY_GCP_BUCKET&#34;) won&#39;t work</span>
</code></pre></div><p><u><b>2 - Adding new packages</b></u></p>
<p>We will need to have a <code>requirements.txt</code> file, since we want to mount it back to GCP with different services, it will look something as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-md" data-lang="md">airflow-provider-great-expectations==0.2.7
apache-airflow-providers-google==10.13.1
requests==2.31.0
lxml==4.9.4
cssselect==1.2.0
discord-webhook==1.3.0
discord==2.3.2
pydantic==1.10.4
pandas==2.0.0
fsspec==2023.12.2
gcsfs==2023.12.2.post1
db-dtypes==1.2.0
</code></pre></div><p>Then we will need a Dockerfile, <strong>remember to make sure the airlfow version that we use in the Dockerfile has to match the airflow version as helm installation</strong></p>
<p>To findout our airflow version, we can use the below command</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">helm list -n airflow
</code></pre></div><p>or find it on the values.yaml which we obtain via</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">helm show values apache-airflow/airflow &gt; values.yaml
</code></pre></div><p>Our Dockerfile will look something as below:</p>
<pre><code class="language-dockerfilek" data-lang="dockerfilek">FROM apache/airflow:2.8.3

COPY requirements.txt .

RUN pip install -r requirements.txt
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">docker build -t airflow-custom .

kind load docker-image airflow-custom<span style="color:#960050;background-color:#1e0010">:</span>latest --name airflow-cluster
</code></pre></div><p>Modify the values.yaml file as below</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">defaultAirflowRepository</span>: <span style="color:#ae81ff">airflow-custom</span> <span style="color:#75715e"># name of docker image</span>

<span style="color:#75715e"># Docer images version - Default airflow tag to deploy</span>
<span style="color:#f92672">defaultAirflowTag</span>: <span style="color:#e6db74">&#34;latest&#34;</span>
</code></pre></div><p>Apply the changes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">helm upgrade --install airflow apache-airflow/airflow -n airflow <span style="color:#f92672">-f</span> values.yaml --debug

<span style="color:#75715e"># To verify</span>
k exec -n airflow airflow-webserver-122343-1232 -- airflow info
</code></pre></div><p>Not all of the pod will be restarted, depending on the changes made on the values.yaml file, you might need to rollout restart the pods manually. Depending on your need, the below command will also trigger a restart of all pods in the namespace.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k delete pods --all -n airflow
</code></pre></div><p><u><b>3 - Add GCP Config</b></u></p>
<p>First oo all, we will need to create a service account with sufficient roles and export the credentials as a json file. Then we will need to create a secret in Kubernetes to store the credentials.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">kubectl create secret generic gcp-sc-key --from<span style="color:#f92672">-file</span>=gcp-key.json=/path/to/your/creds.json -n airflow
</code></pre></div><p>The we will have to modify the <code>values.yaml</code> file as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">env</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">GOOGLE_APPLICATION_CREDENTIALS</span>
    <span style="color:#f92672">value</span>: <span style="color:#e6db74">&#34;/opt/airflow/secrets/gcp-key.json&#34;</span>

<span style="color:#75715e"># Volumes for all airflow containers</span>
<span style="color:#f92672">volumes</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gcp-service-account-volume</span>
    <span style="color:#f92672">secret</span>:
      <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">gcp-sc-key</span>

<span style="color:#75715e"># VolumeMounts for all airflow containers</span>
<span style="color:#f92672">volumeMounts</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">gcp-service-account-volume</span>
    <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/airflow/secrets</span>
</code></pre></div><p>Modify config to have the logs save into GCS bucket in <code>values.yaml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">config</span>:
    <span style="color:#f92672">logging</span>:
    <span style="color:#f92672">remote_logging</span>: <span style="color:#e6db74">&#39;True&#39;</span>
    <span style="color:#f92672">remote_base_log_folder</span>: <span style="color:#e6db74">&#39;gs://gcs-airflow/logs/&#39;</span>
    <span style="color:#f92672">remote_log_conn_id</span>: <span style="color:#e6db74">&#39;gcp-sc-key&#39;</span>
    <span style="color:#f92672">google_key_path</span>:  <span style="color:#e6db74">&#34;/opt/airflow/secrets/gcp-key.json&#34;</span>
</code></pre></div><p>Modify the rest of the services in <code>values.yaml</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#75715e"># Airflow scheduler settings</span>
<span style="color:#f92672">scheduler</span>:
  <span style="color:#f92672">extraVolumeMounts</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">google-cloud-key</span>
      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/airflow/secrets</span>
  <span style="color:#f92672">extraVolumes</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">google-cloud-key</span>
      <span style="color:#f92672">secret</span>:
        <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">gcp-sc-key</span>

<span style="color:#75715e"># Airflow webserver settings</span>
<span style="color:#f92672">webserver</span>:
  <span style="color:#f92672">extraVolumeMounts</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">google-cloud-key</span>
      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/airflow/secrets</span>
  <span style="color:#f92672">extraVolumes</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">google-cloud-key</span>
      <span style="color:#f92672">secret</span>:
        <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">gcp-sc-key</span>

<span style="color:#75715e"># Airflow triggerer settings</span>
<span style="color:#f92672">triggerer</span>:
  <span style="color:#f92672">extraVolumeMounts</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">google-cloud-key</span>
      <span style="color:#f92672">mountPath</span>: <span style="color:#ae81ff">/opt/airflow/secrets</span>
  <span style="color:#f92672">extraVolumes</span>:
    - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">google-cloud-key</span>
      <span style="color:#f92672">secret</span>:
        <span style="color:#f92672">secretName</span>: <span style="color:#ae81ff">gcp-sc-key</span>
</code></pre></div><p>After modifying everything in <code>values.yaml</code>, apply the changes</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">helm upgrade --install airflow apache-airflow/airflow -n airflow <span style="color:#f92672">-f</span> values.yaml --debug
</code></pre></div><p>After running applying the changes successfully, we will start to see logs going into our GCP bucket.</p>
<p align="center">
<img alt = 'png' src='/images/on_airflow/gcp-logs.png'/>
</p>
<p>We can also test it out by exec into a pod</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k get pods -n airflow

k exec --stdin --tty -n airflow airflow-webserver-12344234-234324 -- /bin/bash
</code></pre></div><p>After exec into the pod, run the below command to verify</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell"><span style="color:#75715e"># to check whether the secrets folder is there</span>
ls

cd ls <span style="color:#75715e"># to check is that the gcp secret we added</span>
</code></pre></div><p>Then let’s try connecting to GCP&rsquo;s service</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> google.cloud <span style="color:#f92672">import</span> secretmanager
<span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> getenv

GOOGLE_APPLICATION_CREDENTIALS <span style="color:#f92672">=</span> getenv(<span style="color:#e6db74">&#34;GOOGLE_APPLICATION_CREDENTIALS&#34;</span>)

client <span style="color:#f92672">=</span> secretmanager<span style="color:#f92672">.</span>SecretManagerServiceClient()
</code></pre></div><p>or</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> os <span style="color:#f92672">import</span> getenv
<span style="color:#f92672">from</span> google.cloud <span style="color:#f92672">import</span> bigquery
<span style="color:#f92672">from</span> google.oauth2 <span style="color:#f92672">import</span> service_account

GOOGLE_APPLICATION_CREDENTIALS <span style="color:#f92672">=</span> getenv(<span style="color:#e6db74">&#34;GOOGLE_APPLICATION_CREDENTIALS&#34;</span>)

credentials <span style="color:#f92672">=</span> service_account<span style="color:#f92672">.</span>Credentials<span style="color:#f92672">.</span>from_service_account_file(GOOGLE_APPLICATION_CREDENTIALS, scopes<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;https://www.googleapis.com/auth/cloud-platform&#34;</span>],)
client <span style="color:#f92672">=</span> bigquery<span style="color:#f92672">.</span>Client(credentials<span style="color:#f92672">=</span>credentials, project<span style="color:#f92672">=</span>credentials<span style="color:#f92672">.</span>project_id)
</code></pre></div><p><u><b>4 - Git sync for DAGS</b></u></p>
<p>First of all, we will need to have a ssh key, we can follow the step <a href="https://docs.github.com/en/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent#generating-a-new-ssh-key">here</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">ssh-keygen -t ed25519 -C <span style="color:#e6db74">&#34;email@email.com&#34;</span>

eval <span style="color:#e6db74">&#34;</span>$(ssh-agent -s)<span style="color:#e6db74">&#34;</span>

open ~/.ssh/config

ssh-add --apple-use-keychain ~/.ssh/id_ed25519

<span style="color:#75715e"># Copy the key</span>
pbcopy &lt; ~/.ssh/id_ed25519.pub
</code></pre></div><p>After adding the ssh key on the repo, we will also need to add ssh key to k8s cluster</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k create secret generic ssh-git-secret --from<span style="color:#f92672">-file</span>=gitSshKey=/path/to/.ssh/id_ed25519 -n airflow

<span style="color:#75715e"># To verify</span>
echo ~/.ssh/id_ed25519
</code></pre></div><p>Then we will need to modify the <code>values.yaml</code> file as below:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">gitSync</span>:
    <span style="color:#f92672">enabled</span>: <span style="color:#66d9ef">true</span>
    <span style="color:#f92672">repo</span>: <span style="color:#ae81ff">ssh://git@github.com/gituhub/airflow-dags.git</span>
    <span style="color:#f92672">branch</span>: <span style="color:#ae81ff">main</span>

...<span style="color:#ae81ff">.</span>

<span style="color:#f92672">sshKeySecret</span>: <span style="color:#ae81ff">ssh-git-secret</span> <span style="color:#75715e"># from the above command</span>
</code></pre></div><p>Add a demo DAG to the repo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> datetime, timedelta
<span style="color:#f92672">from</span> textwrap <span style="color:#f92672">import</span> dedent

<span style="color:#75715e"># The DAG object; we&#39;ll need this to instantiate a DAG</span>
<span style="color:#f92672">from</span> airflow <span style="color:#f92672">import</span> DAG

<span style="color:#75715e"># Operators; we need this to operate!</span>
<span style="color:#f92672">from</span> airflow.operators.bash <span style="color:#f92672">import</span> BashOperator
<span style="color:#66d9ef">with</span> DAG(
    <span style="color:#e6db74">&#39;airflow_test_dag&#39;</span>,
    <span style="color:#75715e"># These args will get passed on to each operator</span>
    <span style="color:#75715e"># You can override them on a per-task basis during operator initialization</span>
    default_args<span style="color:#f92672">=</span>{
        <span style="color:#e6db74">&#39;depends_on_past&#39;</span>: False,
        <span style="color:#e6db74">&#39;email&#39;</span>: [<span style="color:#e6db74">&#39;airflow@example.com&#39;</span>],
        <span style="color:#e6db74">&#39;email_on_failure&#39;</span>: False,
        <span style="color:#e6db74">&#39;email_on_retry&#39;</span>: False,
        <span style="color:#e6db74">&#39;retries&#39;</span>: <span style="color:#ae81ff">1</span>,
        <span style="color:#e6db74">&#39;retry_delay&#39;</span>: timedelta(minutes<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>),
    },
    description<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;A simple tutorial DAG&#39;</span>,
    schedule_interval<span style="color:#f92672">=</span>timedelta(days<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>),
    start_date<span style="color:#f92672">=</span>datetime(<span style="color:#ae81ff">2021</span>, <span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">4</span>),
    catchup<span style="color:#f92672">=</span>False,
    tags<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;example&#39;</span>],
) <span style="color:#66d9ef">as</span> dag:

    <span style="color:#75715e"># t1, t2 and t3 are examples of tasks created by instantiating operators</span>
    t1 <span style="color:#f92672">=</span> BashOperator(
        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;print_date&#39;</span>,
        bash_command<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;date&#39;</span>,
    )

    t2 <span style="color:#f92672">=</span> BashOperator(
        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sleep&#39;</span>,
        depends_on_past<span style="color:#f92672">=</span>False,
        bash_command<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;sleep 5&#39;</span>,
        retries<span style="color:#f92672">=</span><span style="color:#ae81ff">3</span>,
    )
    t1<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> dedent(
        <span style="color:#e6db74">&#34;&#34;&#34;</span><span style="color:#ae81ff">\
</span><span style="color:#ae81ff"></span><span style="color:#e6db74">    #### Task Documentation
</span><span style="color:#e6db74">    You can document your task using the attributes `doc_md` (markdown),
</span><span style="color:#e6db74">    `doc` (plain text), `doc_rst`, `doc_json`, `doc_yaml` which gets
</span><span style="color:#e6db74">    rendered in the UI&#39;s Task Instance Details page.
</span><span style="color:#e6db74">    ![img](http://montcs.bloomu.edu/~bobmon/Semesters/2012-01/491/import</span><span style="color:#e6db74">%20s</span><span style="color:#e6db74">oul.png)
</span><span style="color:#e6db74">
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    )

    dag<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> __doc__  <span style="color:#75715e"># providing that you have a docstring at the beginning of the DAG</span>
    dag<span style="color:#f92672">.</span>doc_md <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    This is a documentation placed anywhere
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>  <span style="color:#75715e"># otherwise, type it like this</span>
    templated_command <span style="color:#f92672">=</span> dedent(
        <span style="color:#e6db74">&#34;&#34;&#34;
</span><span style="color:#e6db74">    {</span><span style="color:#e6db74">% f</span><span style="color:#e6db74">or i in range(5) %}
</span><span style="color:#e6db74">        echo &#34;{{ ds }}&#34;
</span><span style="color:#e6db74">        echo &#34;{{ macros.ds_add(ds, 7)}}&#34;
</span><span style="color:#e6db74">    {</span><span style="color:#e6db74">% e</span><span style="color:#e6db74">ndfor %}
</span><span style="color:#e6db74">    &#34;&#34;&#34;</span>
    )

    t3 <span style="color:#f92672">=</span> BashOperator(
        task_id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;templated&#39;</span>,
        depends_on_past<span style="color:#f92672">=</span>False,
        bash_command<span style="color:#f92672">=</span>templated_command,
    )

    t1 <span style="color:#f92672">&gt;&gt;</span> [t2, t3]
</code></pre></div><p>Update helm</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">helm upgrade --install airflow apache-airflow/airflow -n airflow <span style="color:#f92672">-f</span> values.yaml --debug
</code></pre></div><p>It will take a few minutes for the DAG to be synced, we can check on the airflow web UI to verify whether the DAG is synced.</p>
<p><u><b>5 - Airflow Web UI</b></u></p>
<p>Finally, we can verify everything on the Airflow Web UI</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-powershell" data-lang="powershell">k port-forward svc/airflow-webserver 8080<span style="color:#960050;background-color:#1e0010">:</span>8080 -n airflow
</code></pre></div><p>Then in browser, go to <code>localhost:8080</code> to access the Airflow Web UI</p>
<p align="center">
<img alt = 'png' src='/images/on_airflow/airflow-login.png'/>
</p>
<p>And that&rsquo;s it! We now have a fully functional Apache Airflow running on Kubernetes cluster, we all of the pods mounted back to GCP. We also have the Git-Sync feature enabled to automatically sync DAGs from GitHub to Apache Airflow.</p>
<p>In our <a href="https://fishwongy.github.io/post/20240610_airflow_pt2/">next blog post</a>, we will deep dive into DAG implementation.</p>
<p>Thank you for reading and have a nice day!</p>
<p>If you want to support my work,</p>
<p><a href="https://buymeacoffee.com/yuwong">Buy me a coffee</a></p>
<p>Honestly, if you made it this far you already made my day :)</p>

    </article>


    





    
    
    
        
    




<section id="articleNext" class="section nartrow">
    <h3 class="footer-next-heading">More articles from Yu Wong</h3>
    <div class="footer-spacer"></div>
    <div class="next-articles-grid" numberOfArticles={numberOfArticles}>
        <div class="post-row">
            
                <a href="/post/20240528_mongodb/" class="article-link"
                 id="article-link-bigger">
                    <div>
                        <div class="image-container">
                            <img src="/images/on_mongodb/cover-img.png" class="article-image" />
                        </div>
                        <div>
                            <h2 class="article-title">
                                On MongoDB
                            </h2>
                            <p class="article-excerpt">
                                Simple code implementation of reading and writing data to a MongoDB database.
                            </p>
                            <div class="article-metadata">
                                May 28, 2024 · 5 min read
                            </div>
                        </div>
                    </div>
                </a>
            
                <a href="/post/20240518_gcpdatabricks/" class="article-link"
                >
                    <div>
                        <div class="image-container">
                            <img src="/images/on_gcpdatabricks/cover_img.png" class="article-image" />
                        </div>
                        <div>
                            <h2 class="article-title">
                                On GCP Databricks
                            </h2>
                            <p class="article-excerpt">
                                Setting up GCP Databricks with a sample end-to-end ML project
                            </p>
                            <div class="article-metadata">
                                May 18, 2024 · 10 min read
                            </div>
                        </div>
                    </div>
                </a>
            
        </div>
    </div>
</section>

</section>


 <script src="/js/progressBar.js"></script>

        
        <div class="footer-gradient"></div>
    <div class="section narrow">
      <div class="footer-hr"></div>
      <div class="footer-container">
        <div class="footer-text">
          © 2024 Yu Wong
        </div>
        <div class="social-icon-outer">
    <div class="social-icon-container">
        
            
                
                <a href="https://fishwongy.github.io/about"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  d="M7 0C3.14016 0 0 3.14019 0 7C0 10.8598 3.14016 14 7 14C10.8598 14 14 10.8598 14 7C14 3.14019 10.8598 0 7 0ZM11.5616 3.30136C12.3475 4.26869 12.8313 5.48966 12.8715 6.82062C11.4158 6.51926 10.0977 6.55462 8.93404 6.78278C8.72334 6.29005 8.50523 5.82062 8.28509 5.37697C9.55235 4.83104 10.6556 4.13375 11.5616 3.30136ZM10.7731 2.49993C9.87371 3.32085 8.83147 3.92867 7.76427 4.37742C6.98097 2.945 6.23154 1.86633 5.775 1.25333C6.17032 1.16911 6.57995 1.12393 7 1.12393C8.4354 1.12393 9.75151 1.64199 10.7731 2.49993ZM4.63984 1.62041C4.98459 2.06714 5.80572 3.18567 6.68777 4.77709C4.47095 5.49933 2.31992 5.62101 1.28629 5.63232C1.71713 3.83253 2.97749 2.35262 4.63984 1.62041ZM1.13006 6.7591C1.14115 6.7591 1.15187 6.75918 1.16318 6.75918C1.8774 6.75918 3.18594 6.71115 4.72646 6.43024C5.60536 6.26997 6.43879 6.05425 7.22081 5.7869C7.42439 6.19264 7.62677 6.62064 7.82301 7.06923C6.72801 7.42177 5.8046 7.92904 5.07315 8.43271C3.84658 9.27739 2.9873 10.2145 2.51811 10.7939C1.64939 9.76944 1.12392 8.4453 1.12392 7C1.12392 6.91923 1.12677 6.83913 1.13006 6.7591ZM3.328 11.5826C3.73194 11.074 4.55412 10.1482 5.74346 9.33591C6.55171 8.78383 7.3879 8.37367 8.24875 8.10445C8.74822 9.39907 9.17464 10.8295 9.42887 12.3484C8.68798 12.6862 7.86602 12.8761 7 12.8761C5.61143 12.8761 4.33474 12.3909 3.328 11.5826ZM10.4629 11.7432C10.2009 10.3483 9.8101 9.03664 9.35836 7.83793C10.4695 7.65046 11.618 7.68912 12.7975 7.95407C12.5431 9.50435 11.6805 10.8519 10.4629 11.7432Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://fishwongy.github.io/about</span>
            
        
            
                
                <a href="https://github.com/FISHWONGY"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M7 0C3.1325 0 0 3.21173 0 7.17706C0 10.3529 2.00375 13.0353 4.78625 13.9863C5.13625 14.0491 5.2675 13.8338 5.2675 13.6454C5.2675 13.4749 5.25875 12.9097 5.25875 12.3087C3.5 12.6406 3.045 11.8691 2.905 11.4653C2.82625 11.259 2.485 10.622 2.1875 10.4516C1.9425 10.317 1.5925 9.98508 2.17875 9.97611C2.73 9.96714 3.12375 10.4964 3.255 10.7118C3.885 11.7973 4.89125 11.4923 5.29375 11.3039C5.355 10.8374 5.53875 10.5234 5.74 10.3439C4.1825 10.1645 2.555 9.54549 2.555 6.80026C2.555 6.01976 2.82625 5.37382 3.2725 4.87143C3.2025 4.692 2.9575 3.95635 3.3425 2.96951C3.3425 2.96951 3.92875 2.78111 5.2675 3.70516C5.8275 3.54367 6.4225 3.46293 7.0175 3.46293C7.6125 3.46293 8.2075 3.54367 8.7675 3.70516C10.1063 2.77214 10.6925 2.96951 10.6925 2.96951C11.0775 3.95635 10.8325 4.692 10.7625 4.87143C11.2087 5.37382 11.48 6.01079 11.48 6.80026C11.48 9.55446 9.84375 10.1645 8.28625 10.3439C8.54 10.5682 8.75875 10.9988 8.75875 11.6717C8.75875 12.6316 8.75 13.4032 8.75 13.6454C8.75 13.8338 8.88125 14.0581 9.23125 13.9863C11.9963 13.0353 14 10.3439 14 7.17706C14 3.21173 10.8675 0 7 0Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://github.com/FISHWONGY</span>
            
        
            
                
                <a href="https://instagram.com/datavizofficial"><svg
class="social-icon-image"
width="13"
height="13"
viewBox="0 0 13 13"
fill="none"
xmlns="http://www.w3.org/2000/svg"
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M-3.05176e-05 3.97163C-3.05176e-05 1.77803 1.77824 -0.000244141 3.97184 -0.000244141H9.0281C11.2217 -0.000244141 13 1.77802 13 3.97163V9.02788C13 11.2215 11.2217 12.9998 9.0281 12.9998H3.97184C1.77824 12.9998 -3.05176e-05 11.2215 -3.05176e-05 9.02789V3.97163ZM3.97184 1.281C2.48585 1.281 1.28122 2.48564 1.28122 3.97163V9.02789C1.28122 10.5139 2.48585 11.7185 3.97184 11.7185H9.0281C10.5141 11.7185 11.7187 10.5139 11.7187 9.02788V3.97163C11.7187 2.48564 10.5141 1.281 9.0281 1.281H3.97184Z"
  fill="#73737D"
/>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M3.07483 6.55115C3.07483 4.64454 4.61242 3.09253 6.51702 3.09253C8.42162 3.09253 9.95921 4.64454 9.95921 6.55115C9.95921 8.45776 8.42162 10.0098 6.51702 10.0098C4.61242 10.0098 3.07483 8.45776 3.07483 6.55115ZM6.51702 4.37378C5.32709 4.37378 4.35608 5.34508 4.35608 6.55115C4.35608 7.75722 5.32709 8.72853 6.51702 8.72853C7.70695 8.72853 8.67796 7.75722 8.67796 6.55115C8.67796 5.34508 7.70695 4.37378 6.51702 4.37378Z"
  fill="#73737D"
/>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M9.95062 3.87075C10.4035 3.87075 10.7706 3.50149 10.7706 3.04597C10.7706 2.59046 10.4035 2.22119 9.95062 2.22119C9.49776 2.22119 9.13065 2.59046 9.13065 3.04597C9.13065 3.50149 9.49776 3.87075 9.95062 3.87075Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://instagram.com/datavizofficial</span>
            
        
            
                
                <a href="https://www.linkedin.com/in/%F0%9F%92%BB-yu-wong-981612142/"><svg
class="social-icon-image"
width="14"
height="14"
viewBox="0 0 14 14"
fill="none"
xmlns="http://www.w3.org/2000/svg"
{...props}
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M3.59615 13.125H0.871552V4.36523H3.59615V13.125ZM2.24847 3.16406C1.81878 3.16406 1.44769 3.00781 1.13519 2.69531C0.822692 2.38281 0.666443 2.01171 0.666443 1.58203C0.666443 1.15234 0.822692 0.781248 1.13519 0.468749C1.44769 0.156249 1.81878 0 2.24847 0C2.67816 0 3.04925 0.156249 3.36175 0.468749C3.67425 0.781248 3.8305 1.15234 3.8305 1.58203C3.8305 2.01171 3.67425 2.38281 3.36175 2.69531C3.04925 3.00781 2.67816 3.16406 2.24847 3.16406ZM13.7915 13.125H11.0669V8.84765C11.0669 8.14452 11.0083 7.63671 10.8911 7.32421C10.6763 6.79687 10.2563 6.5332 9.63134 6.5332C9.00634 6.5332 8.56689 6.76757 8.31298 7.23632C8.11767 7.58788 8.02001 8.10546 8.02001 8.78905V13.125H5.32471V4.36523H7.93212V5.5664H7.96142C8.15673 5.17578 8.46923 4.85351 8.89892 4.59961C9.36767 4.28711 9.91454 4.13086 10.5395 4.13086C11.8091 4.13086 12.6977 4.53125 13.2055 5.33203C13.5962 5.97656 13.7915 6.97265 13.7915 8.3203V13.125Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://www.linkedin.com/in/%F0%9F%92%BB-yu-wong-981612142/</span>
            
        
            
                
                <a href="https://twitter.com/fishwongxd"><svg
class="social-icon-image"
width="16"
height="13"
viewBox="0 0 16 13"
fill="none"
xmlns="http://www.w3.org/2000/svg"
{...props}
>
<path
  fillRule="evenodd"
  clipRule="evenodd"
  d="M14.0658 2.34438C14.7013 1.96349 15.1892 1.3604 15.419 0.641811C14.8244 0.994439 14.1658 1.25056 13.4648 1.3886C12.9034 0.7905 12.1036 0.416748 11.2185 0.416748C9.51888 0.416748 8.14096 1.79461 8.14096 3.49411C8.14096 3.7353 8.16822 3.97019 8.22068 4.19542C5.66301 4.06708 3.39543 2.84191 1.8776 0.980064C1.6127 1.43458 1.46094 1.96322 1.46094 2.52719C1.46094 3.59485 2.00428 4.5368 2.83003 5.08865C2.32553 5.07268 1.85104 4.93425 1.43608 4.70376C1.43586 4.71659 1.43586 4.72949 1.43586 4.74244C1.43586 6.23349 2.49666 7.47732 3.90448 7.75999C3.64622 7.83033 3.37436 7.86792 3.09366 7.86792C2.89537 7.86792 2.70257 7.84866 2.51471 7.81272C2.90629 9.03537 4.0428 9.92509 5.38945 9.94994C4.33623 10.7753 3.00928 11.2673 1.56749 11.2673C1.31911 11.2673 1.07413 11.2528 0.833374 11.2243C2.19527 12.0975 3.81291 12.6069 5.55081 12.6069C11.2113 12.6069 14.3067 7.91763 14.3067 3.85096C14.3067 3.71753 14.3037 3.5848 14.2978 3.45285C14.899 3.01896 15.4208 2.47694 15.8334 1.8598C15.2815 2.10456 14.6884 2.26998 14.0658 2.34438Z"
  fill="#73737D"
/>
</svg></a>
                <span class="hidden">https://twitter.com/fishwongxd</span>
            
        
    </div>
</div>
    </div>
</div>

    </div>

    
    <script src="/js/prism.js"></script>
</body>

</html>